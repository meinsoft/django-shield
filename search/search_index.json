{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Django Shield","text":"<p>A declarative permission system for Django. Define rules once, protect views with a decorator.</p> <p>Django Shield removes the need to write permission checks in every view. You define rules as simple Python functions, then use the <code>@guard</code> decorator to protect your views.</p>"},{"location":"#key-features","title":"Key Features","text":"Feature Description Expression Syntax Write permissions inline: <code>'obj.author == user'</code> @guard Decorator Protect views with a single line CBV Support Works with class-based views Zero DB Overhead No database tables or migrations Debug Mode See exactly why permissions pass or fail"},{"location":"#before-and-after","title":"Before and After","text":"<p>Without Django Shield:</p> <pre><code>def edit_post(request, pk):\n    post = Post.objects.get(pk=pk)\n\n    if not request.user.is_authenticated:\n        return redirect('login')\n\n    if post.author != request.user and not request.user.is_staff:\n        raise PermissionDenied()\n\n    # Your view code here...\n</code></pre> <p>With Django Shield:</p> <pre><code>@guard('obj.author == user or user.is_staff', model=Post)\ndef edit_post(request, pk):\n    # If user reaches here, they have permission\n    ...\n</code></pre> <p>Or define reusable rules:</p> <pre><code>@rule\ndef can_edit_post(user, post):\n    return post.author == user or user.is_staff\n\n@guard('can_edit_post', model=Post)\ndef edit_post(request, pk):\n    ...\n</code></pre>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>from django_shield import rule, guard\n\n# Define a rule\n@rule\ndef is_author(user, post):\n    return post.author == user\n\n# Protect a view\n@guard('is_author', model=Post, lookup='pk')\ndef edit_post(request, pk):\n    post = Post.objects.get(pk=pk)\n    # User has permission if they reach here\n    ...\n</code></pre>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li>Installation - Install Django Shield</li> <li>Quick Start - Build your first protected view</li> <li>GitHub Repository - Source code and issues</li> </ul>"},{"location":"changelog/","title":"Changelog","text":"<p>All notable changes to Django Shield are documented here.</p>"},{"location":"changelog/#021-2024","title":"[0.2.1] - 2024","text":""},{"location":"changelog/#fixed","title":"Fixed","text":"<ul> <li>Minor bug fixes and improvements</li> </ul>"},{"location":"changelog/#020-2024","title":"[0.2.0] - 2024","text":""},{"location":"changelog/#added","title":"Added","text":"<ul> <li>Class-based View Support: <code>@guard</code> now works with Django CBVs</li> <li>Expression Syntax: Write inline permission checks like <code>'obj.author == user'</code></li> <li>guard.all(): Require all rules to pass</li> <li>guard.any(): Require at least one rule to pass</li> <li>Debug Mode: Enable detailed permission logging with <code>DJANGO_SHIELD['DEBUG'] = True</code></li> <li>Comparison Operators: <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code></li> <li>Boolean Operators: <code>and</code>, <code>or</code>, <code>not</code></li> <li>List Membership: <code>in</code> operator for checking list membership</li> <li>Null Comparison: Compare with <code>null</code> or <code>None</code></li> </ul>"},{"location":"changelog/#changed","title":"Changed","text":"<ul> <li>Improved error messages for permission failures</li> <li>Better exception handling with detailed context</li> </ul>"},{"location":"changelog/#010-2024","title":"[0.1.0] - 2024","text":""},{"location":"changelog/#added_1","title":"Added","text":"<ul> <li>Initial release</li> <li><code>@rule</code> decorator for defining permission rules</li> <li><code>@guard</code> decorator for protecting function-based views</li> <li>Object-level permissions with <code>model</code> parameter</li> <li>Custom lookup fields with <code>lookup</code> and <code>lookup_field</code></li> <li>Auto-inject objects with <code>inject</code> parameter</li> <li><code>RuleRegistry</code> for managing rules</li> <li><code>PermissionDenied</code> exception with context</li> </ul>"},{"location":"changelog/#roadmap","title":"Roadmap","text":""},{"location":"changelog/#030-planned","title":"0.3.0 (Planned)","text":"<ul> <li>Queryset filtering based on rules</li> <li>SQL compilation for database-level filtering</li> </ul>"},{"location":"changelog/#040-planned","title":"0.4.0 (Planned)","text":"<ul> <li>Django REST Framework integration</li> <li>Serializer-level permissions</li> </ul>"},{"location":"changelog/#100-planned","title":"1.0.0 (Planned)","text":"<ul> <li>Async view support</li> <li>Permission caching</li> <li>Production hardening</li> <li>Full test coverage across all Django versions</li> </ul>"},{"location":"changelog/#compatibility","title":"Compatibility","text":"Django Shield Python Django 0.2.x 3.10+ 4.2, 5.0, 5.1 0.1.x 3.10+ 4.2, 5.0, 5.1"},{"location":"changelog/#upgrading","title":"Upgrading","text":""},{"location":"changelog/#from-01x-to-02x","title":"From 0.1.x to 0.2.x","text":"<p>No breaking changes. All existing code continues to work.</p> <p>New features are additive: - Use expression syntax as an alternative to named rules - Add <code>@guard</code> to class-based views - Use <code>guard.all()</code> and <code>guard.any()</code> for multiple rules</p>"},{"location":"api/reference/","title":"API Reference","text":"<p>Complete reference for all Django Shield functions, classes, and exceptions.</p>"},{"location":"api/reference/#decorators","title":"Decorators","text":""},{"location":"api/reference/#rule","title":"@rule","text":"<p>Register a permission rule function.</p> <pre><code>from django_shield import rule\n\n@rule\ndef rule_name(user, obj=None):\n    return True  # or False\n</code></pre> <p>Parameters:</p> Parameter Type Default Description <code>func</code> callable None The function to decorate <code>name</code> str None Custom rule name (defaults to function name) <p>Usage:</p> <pre><code># Basic usage - function name becomes rule name\n@rule\ndef is_author(user, post):\n    return post.author == user\n\n# Custom name\n@rule(name='can_edit')\ndef check_edit_permission(user, obj):\n    return obj.author == user\n</code></pre>"},{"location":"api/reference/#guard","title":"@guard","text":"<p>Protect a view with permission checks.</p> <pre><code>from django_shield import guard\n\n@guard(rule_name, model=None, lookup='pk', lookup_field='pk', inject=None)\ndef view(request, ...):\n    ...\n</code></pre> <p>Parameters:</p> Parameter Type Default Description <code>rule_name</code> str required Rule name or expression to check <code>model</code> Model None Django model class to fetch <code>lookup</code> str <code>'pk'</code> URL parameter name <code>lookup_field</code> str <code>'pk'</code> Model field to query <code>inject</code> str None Parameter name to pass object to view <p>Returns: Decorated view function or class</p> <p>Raises: <code>PermissionDenied</code> if check fails</p> <p>Usage:</p> <pre><code># Basic\n@guard('is_staff')\ndef admin_view(request):\n    ...\n\n# With model\n@guard('is_author', model=Post)\ndef edit_post(request, pk):\n    ...\n\n# With all parameters\n@guard('is_author', model=Post, lookup='post_id', lookup_field='id', inject='post')\ndef edit_post(request, post_id, post):\n    ...\n\n# With class-based view\n@guard('is_author')\nclass PostEditView(UpdateView):\n    model = Post\n</code></pre>"},{"location":"api/reference/#guardall","title":"guard.all()","text":"<p>All rules must pass.</p> <pre><code>@guard.all(*rules, model=None, lookup='pk', lookup_field='pk', inject=None)\n</code></pre> <p>Parameters: Same as <code>@guard</code></p> <p>Usage:</p> <pre><code>@guard.all('is_authenticated', 'is_verified', 'is_active')\ndef secure_view(request):\n    ...\n\n@guard.all('is_team_member', 'has_edit_permission', model=Project)\ndef edit_project(request, pk):\n    ...\n</code></pre>"},{"location":"api/reference/#guardany","title":"guard.any()","text":"<p>At least one rule must pass.</p> <pre><code>@guard.any(*rules, model=None, lookup='pk', lookup_field='pk', inject=None)\n</code></pre> <p>Parameters: Same as <code>@guard</code></p> <p>Usage:</p> <pre><code>@guard.any('is_owner', 'is_admin', 'is_moderator')\ndef manage_content(request):\n    ...\n</code></pre>"},{"location":"api/reference/#classes","title":"Classes","text":""},{"location":"api/reference/#rule_1","title":"Rule","text":"<p>Represents a registered permission rule.</p> <pre><code>from django_shield import Rule\n</code></pre> <p>Attributes:</p> Attribute Type Description <code>name</code> str The rule name <code>predicate</code> callable The check function <p>Methods:</p>"},{"location":"api/reference/#checkuser-objnone","title":"check(user, obj=None)","text":"<p>Execute the permission check.</p> <pre><code>rule.check(user, obj)  # Returns True or False\n</code></pre>"},{"location":"api/reference/#ruleregistry","title":"RuleRegistry","text":"<p>Registry of all defined rules.</p> <pre><code>from django_shield import RuleRegistry\n</code></pre> <p>Class Methods:</p>"},{"location":"api/reference/#registerrule","title":"register(rule)","text":"<p>Register a Rule instance.</p> <pre><code>RuleRegistry.register(rule)\n</code></pre>"},{"location":"api/reference/#getname","title":"get(name)","text":"<p>Get a rule by name.</p> <pre><code>rule = RuleRegistry.get('is_author')  # Returns Rule or None\n</code></pre>"},{"location":"api/reference/#existsname","title":"exists(name)","text":"<p>Check if a rule is registered.</p> <pre><code>if RuleRegistry.exists('is_author'):\n    ...\n</code></pre>"},{"location":"api/reference/#clear","title":"clear()","text":"<p>Remove all registered rules. Useful for testing.</p> <pre><code>RuleRegistry.clear()\n</code></pre>"},{"location":"api/reference/#exceptions","title":"Exceptions","text":""},{"location":"api/reference/#djangoshielderror","title":"DjangoShieldError","text":"<p>Base exception for all Django Shield errors.</p> <pre><code>from django_shield import DjangoShieldError\n</code></pre>"},{"location":"api/reference/#permissiondenied","title":"PermissionDenied","text":"<p>Raised when a permission check fails.</p> <pre><code>from django_shield import PermissionDenied\n</code></pre> <p>Attributes:</p> Attribute Type Description <code>rule_name</code> str Name of the failed rule <code>user</code> User The user who was denied <code>obj</code> object The object (if any) <p>Usage:</p> <pre><code>try:\n    # guarded operation\nexcept PermissionDenied as e:\n    print(f\"Rule: {e.rule_name}\")\n    print(f\"User: {e.user}\")\n    print(f\"Object: {e.obj}\")\n</code></pre>"},{"location":"api/reference/#expressionsyntaxerror","title":"ExpressionSyntaxError","text":"<p>Raised when an expression has invalid syntax.</p> <pre><code>from django_shield import ExpressionSyntaxError\n</code></pre> <p>Attributes:</p> Attribute Type Description <code>expression</code> str The invalid expression <code>position</code> int Error position in expression"},{"location":"api/reference/#expressionevaluationerror","title":"ExpressionEvaluationError","text":"<p>Raised when expression evaluation fails.</p> <pre><code>from django_shield import ExpressionEvaluationError\n</code></pre> <p>Attributes:</p> Attribute Type Description <code>expression</code> str The expression <code>detail</code> str Error details"},{"location":"api/reference/#expression-syntax","title":"Expression Syntax","text":""},{"location":"api/reference/#operators","title":"Operators","text":"Operator Description Example <code>==</code> Equal <code>obj.status == \"active\"</code> <code>!=</code> Not equal <code>obj.status != \"deleted\"</code> <code>&gt;</code> Greater than <code>obj.count &gt; 10</code> <code>&lt;</code> Less than <code>obj.count &lt; 10</code> <code>&gt;=</code> Greater or equal <code>obj.age &gt;= 18</code> <code>&lt;=</code> Less or equal <code>obj.price &lt;= 100</code> <code>and</code> Logical AND <code>a and b</code> <code>or</code> Logical OR <code>a or b</code> <code>not</code> Logical NOT <code>not a</code> <code>in</code> List membership <code>x in [1, 2, 3]</code>"},{"location":"api/reference/#references","title":"References","text":"Reference Description Example <code>obj</code> Current object <code>obj.author</code> <code>obj.field</code> Object attribute <code>obj.status</code> <code>obj.a.b</code> Nested attribute <code>obj.author.name</code> <code>user</code> Current user <code>obj.author == user</code> <code>user.field</code> User attribute <code>user.is_staff</code>"},{"location":"api/reference/#literals","title":"Literals","text":"Type Example String <code>\"active\"</code> Integer <code>42</code>, <code>-5</code> Float <code>3.14</code>, <code>-0.5</code> Boolean <code>true</code>, <code>false</code>, <code>True</code>, <code>False</code> Null <code>null</code>, <code>None</code> List <code>[1, 2, 3]</code>, <code>[\"a\", \"b\"]</code>"},{"location":"api/reference/#precedence","title":"Precedence","text":"<p>From highest to lowest:</p> <ol> <li>Parentheses <code>()</code></li> <li>Attribute access <code>.</code></li> <li>Comparison <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code></li> <li><code>in</code></li> <li><code>not</code></li> <li><code>and</code></li> <li><code>or</code></li> </ol>"},{"location":"api/reference/#settings","title":"Settings","text":"<p>Configure Django Shield in <code>settings.py</code>:</p> <pre><code>DJANGO_SHIELD = {\n    'DEBUG': False,  # Enable debug logging\n}\n</code></pre> Setting Type Default Description <code>DEBUG</code> bool <code>False</code> Enable debug output"},{"location":"api/reference/#module-exports","title":"Module Exports","text":"<pre><code>from django_shield import (\n    # Decorators\n    rule,\n    guard,\n\n    # Classes\n    Rule,\n    RuleRegistry,\n\n    # Exceptions\n    DjangoShieldError,\n    PermissionDenied,\n    ExpressionSyntaxError,\n    ExpressionEvaluationError,\n)\n</code></pre>"},{"location":"examples/blog/","title":"Blog Application","text":"<p>This example shows how to implement permissions for a typical blog application.</p>"},{"location":"examples/blog/#models","title":"Models","text":"<pre><code># models.py\nfrom django.db import models\nfrom django.contrib.auth import get_user_model\n\nUser = get_user_model()\n\nclass Post(models.Model):\n    STATUS_CHOICES = [\n        ('draft', 'Draft'),\n        ('review', 'In Review'),\n        ('published', 'Published'),\n    ]\n\n    title = models.CharField(max_length=200)\n    content = models.TextField()\n    author = models.ForeignKey(User, on_delete=models.CASCADE)\n    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='draft')\n    is_featured = models.BooleanField(default=False)\n    created_at = models.DateTimeField(auto_now_add=True)\n\nclass Comment(models.Model):\n    post = models.ForeignKey(Post, on_delete=models.CASCADE, related_name='comments')\n    author = models.ForeignKey(User, on_delete=models.CASCADE)\n    content = models.TextField()\n    is_approved = models.BooleanField(default=False)\n    created_at = models.DateTimeField(auto_now_add=True)\n</code></pre>"},{"location":"examples/blog/#permissions","title":"Permissions","text":"<pre><code># permissions.py\nfrom django_shield import rule\n\n# User-level rules\n@rule\ndef is_authenticated(user, obj=None):\n    return user.is_authenticated\n\n@rule\ndef is_staff(user, obj=None):\n    return user.is_staff\n\n@rule\ndef is_editor(user, obj=None):\n    return hasattr(user, 'role') and user.role == 'editor'\n\n# Post rules\n@rule\ndef is_post_author(user, post):\n    return post.author == user\n\n@rule\ndef is_post_published(user, post):\n    return post.status == 'published'\n\n@rule\ndef can_view_post(user, post):\n    if post.status == 'published':\n        return True\n    return post.author == user or user.is_staff\n\n@rule\ndef can_edit_post(user, post):\n    if user.is_staff:\n        return True\n    return post.author == user and post.status in ['draft', 'review']\n\n@rule\ndef can_delete_post(user, post):\n    if user.is_superuser:\n        return True\n    return post.author == user and post.status == 'draft'\n\n@rule\ndef can_publish_post(user, post):\n    return user.is_staff or (hasattr(user, 'role') and user.role == 'editor')\n\n# Comment rules\n@rule\ndef is_comment_author(user, comment):\n    return comment.author == user\n\n@rule\ndef can_moderate_comment(user, comment):\n    return user.is_staff or comment.post.author == user\n</code></pre>"},{"location":"examples/blog/#views","title":"Views","text":""},{"location":"examples/blog/#function-based-views","title":"Function-based Views","text":"<pre><code># views.py\nfrom django.shortcuts import render, redirect\nfrom django.http import HttpResponse\nfrom django_shield import guard\nfrom .models import Post, Comment\n\n# Public: List published posts\ndef post_list(request):\n    posts = Post.objects.filter(status='published')\n    return render(request, 'blog/post_list.html', {'posts': posts})\n\n# View single post\n@guard('can_view_post', model=Post, inject='post')\ndef post_detail(request, pk, post):\n    return render(request, 'blog/post_detail.html', {'post': post})\n\n# Create new post\n@guard('is_authenticated')\ndef post_create(request):\n    if request.method == 'POST':\n        post = Post.objects.create(\n            title=request.POST['title'],\n            content=request.POST['content'],\n            author=request.user,\n            status='draft'\n        )\n        return redirect('post_detail', pk=post.pk)\n    return render(request, 'blog/post_form.html')\n\n# Edit post\n@guard('can_edit_post', model=Post, inject='post')\ndef post_edit(request, pk, post):\n    if request.method == 'POST':\n        post.title = request.POST['title']\n        post.content = request.POST['content']\n        post.save()\n        return redirect('post_detail', pk=post.pk)\n    return render(request, 'blog/post_form.html', {'post': post})\n\n# Delete post\n@guard('can_delete_post', model=Post, inject='post')\ndef post_delete(request, pk, post):\n    if request.method == 'POST':\n        post.delete()\n        return redirect('post_list')\n    return render(request, 'blog/post_confirm_delete.html', {'post': post})\n\n# Publish post (staff/editor only)\n@guard('can_publish_post', model=Post, inject='post')\ndef post_publish(request, pk, post):\n    post.status = 'published'\n    post.save()\n    return redirect('post_detail', pk=post.pk)\n\n# Add comment\n@guard('is_authenticated')\ndef comment_create(request, post_pk):\n    post = Post.objects.get(pk=post_pk)\n    if request.method == 'POST':\n        Comment.objects.create(\n            post=post,\n            author=request.user,\n            content=request.POST['content']\n        )\n        return redirect('post_detail', pk=post_pk)\n    return render(request, 'blog/comment_form.html', {'post': post})\n\n# Delete own comment or moderate\n@guard.any('is_comment_author', 'can_moderate_comment', model=Comment)\ndef comment_delete(request, pk):\n    comment = Comment.objects.get(pk=pk)\n    post_pk = comment.post.pk\n    comment.delete()\n    return redirect('post_detail', pk=post_pk)\n\n# Approve comment (moderation)\n@guard('can_moderate_comment', model=Comment, inject='comment')\ndef comment_approve(request, pk, comment):\n    comment.is_approved = True\n    comment.save()\n    return redirect('post_detail', pk=comment.post.pk)\n</code></pre>"},{"location":"examples/blog/#class-based-views","title":"Class-based Views","text":"<pre><code># views.py\nfrom django.views.generic import ListView, DetailView, CreateView, UpdateView, DeleteView\nfrom django.urls import reverse_lazy\nfrom django_shield import guard\nfrom .models import Post\n\nclass PostListView(ListView):\n    model = Post\n    template_name = 'blog/post_list.html'\n    queryset = Post.objects.filter(status='published')\n\n@guard('can_view_post')\nclass PostDetailView(DetailView):\n    model = Post\n    template_name = 'blog/post_detail.html'\n\n@guard('is_authenticated')\nclass PostCreateView(CreateView):\n    model = Post\n    fields = ['title', 'content']\n    template_name = 'blog/post_form.html'\n\n    def form_valid(self, form):\n        form.instance.author = self.request.user\n        form.instance.status = 'draft'\n        return super().form_valid(form)\n\n@guard('can_edit_post')\nclass PostUpdateView(UpdateView):\n    model = Post\n    fields = ['title', 'content']\n    template_name = 'blog/post_form.html'\n\n@guard('can_delete_post')\nclass PostDeleteView(DeleteView):\n    model = Post\n    template_name = 'blog/post_confirm_delete.html'\n    success_url = reverse_lazy('post_list')\n</code></pre>"},{"location":"examples/blog/#urls","title":"URLs","text":"<pre><code># urls.py\nfrom django.urls import path\nfrom . import views\n\nurlpatterns = [\n    path('', views.post_list, name='post_list'),\n    path('posts/&lt;int:pk&gt;/', views.post_detail, name='post_detail'),\n    path('posts/new/', views.post_create, name='post_create'),\n    path('posts/&lt;int:pk&gt;/edit/', views.post_edit, name='post_edit'),\n    path('posts/&lt;int:pk&gt;/delete/', views.post_delete, name='post_delete'),\n    path('posts/&lt;int:pk&gt;/publish/', views.post_publish, name='post_publish'),\n    path('posts/&lt;int:post_pk&gt;/comments/new/', views.comment_create, name='comment_create'),\n    path('comments/&lt;int:pk&gt;/delete/', views.comment_delete, name='comment_delete'),\n    path('comments/&lt;int:pk&gt;/approve/', views.comment_approve, name='comment_approve'),\n]\n</code></pre>"},{"location":"examples/blog/#using-expression-syntax","title":"Using Expression Syntax","text":"<p>For simpler cases, use expression syntax instead of named rules:</p> <pre><code># Instead of defining can_view_post rule\n@guard('obj.status == \"published\" or obj.author == user or user.is_staff', model=Post)\ndef post_detail(request, pk):\n    ...\n\n# Instead of defining can_edit_post rule\n@guard('user.is_staff or (obj.author == user and obj.status in [\"draft\", \"review\"])', model=Post)\ndef post_edit(request, pk):\n    ...\n\n# Simple checks\n@guard('user.is_authenticated')\ndef post_create(request):\n    ...\n</code></pre>"},{"location":"examples/blog/#permission-summary","title":"Permission Summary","text":"Action Rule Who Can Do It View published post Anyone All visitors View draft post <code>can_view_post</code> Author, Staff Create post <code>is_authenticated</code> Logged in users Edit own draft <code>can_edit_post</code> Author Edit any post <code>can_edit_post</code> Staff Delete own draft <code>can_delete_post</code> Author Delete any post <code>can_delete_post</code> Superuser Publish post <code>can_publish_post</code> Staff, Editor Delete comment <code>is_comment_author</code> or <code>can_moderate_comment</code> Comment author, Post author, Staff Approve comment <code>can_moderate_comment</code> Post author, Staff"},{"location":"examples/ecommerce/","title":"E-commerce Application","text":"<p>This example shows how to implement permissions for an e-commerce platform.</p>"},{"location":"examples/ecommerce/#models","title":"Models","text":"<pre><code># models.py\nfrom django.db import models\nfrom django.contrib.auth import get_user_model\n\nUser = get_user_model()\n\nclass Store(models.Model):\n    name = models.CharField(max_length=200)\n    owner = models.ForeignKey(User, on_delete=models.CASCADE, related_name='stores')\n    is_active = models.BooleanField(default=True)\n\nclass Product(models.Model):\n    store = models.ForeignKey(Store, on_delete=models.CASCADE, related_name='products')\n    name = models.CharField(max_length=200)\n    price = models.DecimalField(max_digits=10, decimal_places=2)\n    stock = models.PositiveIntegerField(default=0)\n    is_published = models.BooleanField(default=False)\n\nclass Order(models.Model):\n    STATUS_CHOICES = [\n        ('pending', 'Pending'),\n        ('paid', 'Paid'),\n        ('shipped', 'Shipped'),\n        ('delivered', 'Delivered'),\n        ('cancelled', 'Cancelled'),\n        ('refunded', 'Refunded'),\n    ]\n\n    customer = models.ForeignKey(User, on_delete=models.CASCADE, related_name='orders')\n    store = models.ForeignKey(Store, on_delete=models.CASCADE, related_name='orders')\n    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='pending')\n    total = models.DecimalField(max_digits=10, decimal_places=2)\n    created_at = models.DateTimeField(auto_now_add=True)\n\nclass Review(models.Model):\n    product = models.ForeignKey(Product, on_delete=models.CASCADE, related_name='reviews')\n    customer = models.ForeignKey(User, on_delete=models.CASCADE)\n    rating = models.PositiveSmallIntegerField()\n    comment = models.TextField()\n    is_verified_purchase = models.BooleanField(default=False)\n</code></pre>"},{"location":"examples/ecommerce/#permissions","title":"Permissions","text":"<pre><code># permissions.py\nfrom django_shield import rule\n\n# Store permissions\n@rule\ndef is_store_owner(user, store):\n    return store.owner == user\n\n@rule\ndef is_store_staff(user, store):\n    return user in store.staff.all() if hasattr(store, 'staff') else False\n\n@rule\ndef can_manage_store(user, store):\n    return store.owner == user or user.is_staff\n\n# Product permissions\n@rule\ndef can_view_product(user, product):\n    if product.is_published:\n        return True\n    return product.store.owner == user\n\n@rule\ndef can_edit_product(user, product):\n    return product.store.owner == user or user.is_staff\n\n# Order permissions\n@rule\ndef is_order_customer(user, order):\n    return order.customer == user\n\n@rule\ndef is_order_seller(user, order):\n    return order.store.owner == user\n\n@rule\ndef can_view_order(user, order):\n    return order.customer == user or order.store.owner == user or user.is_staff\n\n@rule\ndef can_cancel_order(user, order):\n    if order.status not in ['pending', 'paid']:\n        return False\n    return order.customer == user\n\n@rule\ndef can_update_order_status(user, order):\n    return order.store.owner == user or user.is_staff\n\n@rule\ndef can_refund_order(user, order):\n    if order.status not in ['paid', 'shipped', 'delivered']:\n        return False\n    return user.is_staff or order.store.owner == user\n\n# Review permissions\n@rule\ndef can_write_review(user, product):\n    # Check if user has purchased this product\n    from .models import Order\n    return Order.objects.filter(\n        customer=user,\n        store=product.store,\n        status='delivered'\n    ).exists()\n\n@rule\ndef is_review_author(user, review):\n    return review.customer == user\n\n@rule\ndef can_delete_review(user, review):\n    return review.customer == user or review.product.store.owner == user or user.is_staff\n</code></pre>"},{"location":"examples/ecommerce/#views","title":"Views","text":"<pre><code># views.py\nfrom django.shortcuts import render, redirect, get_object_or_404\nfrom django_shield import guard\nfrom .models import Store, Product, Order, Review\n\n# Store management\n@guard('is_store_owner', model=Store, inject='store')\ndef store_dashboard(request, store_id, store):\n    products = store.products.all()\n    orders = store.orders.all()[:10]\n    return render(request, 'ecommerce/store_dashboard.html', {\n        'store': store,\n        'products': products,\n        'orders': orders\n    })\n\n@guard('can_manage_store', model=Store, inject='store')\ndef store_settings(request, store_id, store):\n    if request.method == 'POST':\n        store.name = request.POST['name']\n        store.save()\n        return redirect('store_dashboard', store_id=store.pk)\n    return render(request, 'ecommerce/store_settings.html', {'store': store})\n\n# Product management\n@guard('can_view_product', model=Product, inject='product')\ndef product_detail(request, pk, product):\n    return render(request, 'ecommerce/product_detail.html', {'product': product})\n\n@guard('is_store_owner', model=Store, lookup='store_id', inject='store')\ndef product_create(request, store_id, store):\n    if request.method == 'POST':\n        product = Product.objects.create(\n            store=store,\n            name=request.POST['name'],\n            price=request.POST['price'],\n            stock=request.POST['stock']\n        )\n        return redirect('product_detail', pk=product.pk)\n    return render(request, 'ecommerce/product_form.html', {'store': store})\n\n@guard('can_edit_product', model=Product, inject='product')\ndef product_edit(request, pk, product):\n    if request.method == 'POST':\n        product.name = request.POST['name']\n        product.price = request.POST['price']\n        product.stock = request.POST['stock']\n        product.save()\n        return redirect('product_detail', pk=product.pk)\n    return render(request, 'ecommerce/product_form.html', {'product': product})\n\n# Order management\n@guard('can_view_order', model=Order, inject='order')\ndef order_detail(request, order_id, order):\n    return render(request, 'ecommerce/order_detail.html', {'order': order})\n\n@guard('is_order_customer', model=Order, lookup='order_id')\ndef order_list(request):\n    orders = Order.objects.filter(customer=request.user)\n    return render(request, 'ecommerce/order_list.html', {'orders': orders})\n\n@guard('can_cancel_order', model=Order, lookup='order_id', inject='order')\ndef order_cancel(request, order_id, order):\n    order.status = 'cancelled'\n    order.save()\n    return redirect('order_detail', order_id=order.pk)\n\n@guard('can_update_order_status', model=Order, lookup='order_id', inject='order')\ndef order_ship(request, order_id, order):\n    if order.status == 'paid':\n        order.status = 'shipped'\n        order.save()\n    return redirect('order_detail', order_id=order.pk)\n\n@guard('can_refund_order', model=Order, lookup='order_id', inject='order')\ndef order_refund(request, order_id, order):\n    order.status = 'refunded'\n    order.save()\n    # Process refund logic here\n    return redirect('order_detail', order_id=order.pk)\n\n# Seller's order management\n@guard('is_order_seller', model=Order, lookup='order_id', inject='order')\ndef seller_order_detail(request, order_id, order):\n    return render(request, 'ecommerce/seller_order_detail.html', {'order': order})\n\n# Reviews\n@guard('can_write_review', model=Product, lookup='product_id', inject='product')\ndef review_create(request, product_id, product):\n    if request.method == 'POST':\n        Review.objects.create(\n            product=product,\n            customer=request.user,\n            rating=request.POST['rating'],\n            comment=request.POST['comment'],\n            is_verified_purchase=True\n        )\n        return redirect('product_detail', pk=product.pk)\n    return render(request, 'ecommerce/review_form.html', {'product': product})\n\n@guard('can_delete_review', model=Review, inject='review')\ndef review_delete(request, pk, review):\n    product_pk = review.product.pk\n    review.delete()\n    return redirect('product_detail', pk=product_pk)\n</code></pre>"},{"location":"examples/ecommerce/#expression-syntax-examples","title":"Expression Syntax Examples","text":"<pre><code># Simple owner check\n@guard('obj.store.owner == user', model=Product)\ndef product_edit(request, pk):\n    ...\n\n# Status-based permission\n@guard('obj.status in [\"pending\", \"paid\"] and obj.customer == user', model=Order)\ndef order_cancel(request, order_id):\n    ...\n\n# Multiple conditions\n@guard('obj.customer == user or obj.store.owner == user or user.is_staff', model=Order)\ndef order_detail(request, order_id):\n    ...\n\n# Staff override\n@guard('user.is_staff or obj.store.owner == user', model=Product)\ndef product_edit(request, pk):\n    ...\n</code></pre>"},{"location":"examples/ecommerce/#urls","title":"URLs","text":"<pre><code># urls.py\nfrom django.urls import path\nfrom . import views\n\nurlpatterns = [\n    # Store management\n    path('stores/&lt;int:store_id&gt;/', views.store_dashboard, name='store_dashboard'),\n    path('stores/&lt;int:store_id&gt;/settings/', views.store_settings, name='store_settings'),\n\n    # Products\n    path('products/&lt;int:pk&gt;/', views.product_detail, name='product_detail'),\n    path('stores/&lt;int:store_id&gt;/products/new/', views.product_create, name='product_create'),\n    path('products/&lt;int:pk&gt;/edit/', views.product_edit, name='product_edit'),\n\n    # Orders (customer)\n    path('orders/', views.order_list, name='order_list'),\n    path('orders/&lt;int:order_id&gt;/', views.order_detail, name='order_detail'),\n    path('orders/&lt;int:order_id&gt;/cancel/', views.order_cancel, name='order_cancel'),\n\n    # Orders (seller)\n    path('seller/orders/&lt;int:order_id&gt;/', views.seller_order_detail, name='seller_order_detail'),\n    path('seller/orders/&lt;int:order_id&gt;/ship/', views.order_ship, name='order_ship'),\n    path('seller/orders/&lt;int:order_id&gt;/refund/', views.order_refund, name='order_refund'),\n\n    # Reviews\n    path('products/&lt;int:product_id&gt;/reviews/new/', views.review_create, name='review_create'),\n    path('reviews/&lt;int:pk&gt;/delete/', views.review_delete, name='review_delete'),\n]\n</code></pre>"},{"location":"examples/ecommerce/#permission-summary","title":"Permission Summary","text":"Action Rule Who Can Do It View store dashboard <code>is_store_owner</code> Store owner Manage store settings <code>can_manage_store</code> Store owner, Admin View published product Anyone All visitors View unpublished product <code>can_view_product</code> Store owner Create product <code>is_store_owner</code> Store owner Edit product <code>can_edit_product</code> Store owner, Admin View own order <code>is_order_customer</code> Customer View order as seller <code>is_order_seller</code> Store owner Cancel order <code>can_cancel_order</code> Customer (if pending/paid) Ship order <code>can_update_order_status</code> Store owner, Admin Refund order <code>can_refund_order</code> Store owner, Admin Write review <code>can_write_review</code> Verified purchasers Delete review <code>can_delete_review</code> Reviewer, Store owner, Admin"},{"location":"examples/saas/","title":"Multi-tenant SaaS Application","text":"<p>This example shows how to implement permissions for a multi-tenant SaaS application with organizations, teams, and role-based access.</p>"},{"location":"examples/saas/#models","title":"Models","text":"<pre><code># models.py\nfrom django.db import models\nfrom django.contrib.auth import get_user_model\n\nUser = get_user_model()\n\nclass Organization(models.Model):\n    name = models.CharField(max_length=200)\n    slug = models.SlugField(unique=True)\n    owner = models.ForeignKey(User, on_delete=models.CASCADE, related_name='owned_orgs')\n    plan = models.CharField(max_length=20, default='free')  # free, pro, enterprise\n    created_at = models.DateTimeField(auto_now_add=True)\n\nclass Membership(models.Model):\n    ROLE_CHOICES = [\n        ('owner', 'Owner'),\n        ('admin', 'Admin'),\n        ('member', 'Member'),\n        ('viewer', 'Viewer'),\n    ]\n\n    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='memberships')\n    organization = models.ForeignKey(Organization, on_delete=models.CASCADE, related_name='memberships')\n    role = models.CharField(max_length=20, choices=ROLE_CHOICES, default='member')\n    joined_at = models.DateTimeField(auto_now_add=True)\n\n    class Meta:\n        unique_together = ['user', 'organization']\n\nclass Project(models.Model):\n    organization = models.ForeignKey(Organization, on_delete=models.CASCADE, related_name='projects')\n    name = models.CharField(max_length=200)\n    description = models.TextField(blank=True)\n    is_archived = models.BooleanField(default=False)\n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n\nclass Task(models.Model):\n    project = models.ForeignKey(Project, on_delete=models.CASCADE, related_name='tasks')\n    title = models.CharField(max_length=200)\n    description = models.TextField(blank=True)\n    assignee = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True)\n    is_completed = models.BooleanField(default=False)\n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, related_name='created_tasks')\n\nclass Document(models.Model):\n    project = models.ForeignKey(Project, on_delete=models.CASCADE, related_name='documents')\n    title = models.CharField(max_length=200)\n    content = models.TextField()\n    is_public = models.BooleanField(default=False)\n    created_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)\n</code></pre>"},{"location":"examples/saas/#permissions","title":"Permissions","text":"<pre><code># permissions.py\nfrom django_shield import rule\nfrom .models import Membership\n\ndef get_membership(user, organization):\n    \"\"\"Helper to get user's membership in an organization.\"\"\"\n    try:\n        return Membership.objects.get(user=user, organization=organization)\n    except Membership.DoesNotExist:\n        return None\n\ndef get_user_role(user, organization):\n    \"\"\"Get user's role in organization.\"\"\"\n    membership = get_membership(user, organization)\n    return membership.role if membership else None\n\n# Organization permissions\n@rule\ndef is_org_member(user, org):\n    return Membership.objects.filter(user=user, organization=org).exists()\n\n@rule\ndef is_org_admin(user, org):\n    role = get_user_role(user, org)\n    return role in ['owner', 'admin']\n\n@rule\ndef is_org_owner(user, org):\n    return org.owner == user\n\n@rule\ndef can_manage_org(user, org):\n    return org.owner == user or user.is_superuser\n\n@rule\ndef can_invite_members(user, org):\n    role = get_user_role(user, org)\n    return role in ['owner', 'admin']\n\n@rule\ndef can_remove_members(user, org):\n    role = get_user_role(user, org)\n    return role in ['owner', 'admin']\n\n# Project permissions\n@rule\ndef can_view_project(user, project):\n    if project.is_archived:\n        role = get_user_role(user, project.organization)\n        return role in ['owner', 'admin']\n    return is_org_member.predicate(user, project.organization)\n\n@rule\ndef can_edit_project(user, project):\n    role = get_user_role(user, project.organization)\n    return role in ['owner', 'admin', 'member']\n\n@rule\ndef can_delete_project(user, project):\n    role = get_user_role(user, project.organization)\n    return role in ['owner', 'admin']\n\n@rule\ndef can_archive_project(user, project):\n    role = get_user_role(user, project.organization)\n    return role in ['owner', 'admin']\n\n# Task permissions\n@rule\ndef can_view_task(user, task):\n    return is_org_member.predicate(user, task.project.organization)\n\n@rule\ndef can_edit_task(user, task):\n    role = get_user_role(user, task.project.organization)\n    if role == 'viewer':\n        return False\n    return True\n\n@rule\ndef can_assign_task(user, task):\n    role = get_user_role(user, task.project.organization)\n    return role in ['owner', 'admin', 'member']\n\n@rule\ndef is_task_assignee(user, task):\n    return task.assignee == user\n\n# Document permissions\n@rule\ndef can_view_document(user, document):\n    if document.is_public:\n        return True\n    return is_org_member.predicate(user, document.project.organization)\n\n@rule\ndef can_edit_document(user, document):\n    role = get_user_role(user, document.project.organization)\n    return role in ['owner', 'admin', 'member']\n\n@rule\ndef can_delete_document(user, document):\n    if document.created_by == user:\n        return True\n    role = get_user_role(user, document.project.organization)\n    return role in ['owner', 'admin']\n\n# Plan-based permissions\n@rule\ndef has_pro_plan(user, org):\n    return org.plan in ['pro', 'enterprise']\n\n@rule\ndef has_enterprise_plan(user, org):\n    return org.plan == 'enterprise'\n\n@rule\ndef can_use_advanced_features(user, org):\n    return org.plan in ['pro', 'enterprise'] and is_org_member.predicate(user, org)\n</code></pre>"},{"location":"examples/saas/#views","title":"Views","text":"<pre><code># views.py\nfrom django.shortcuts import render, redirect, get_object_or_404\nfrom django_shield import guard\nfrom .models import Organization, Project, Task, Document, Membership\n\n# Organization views\n@guard('is_org_member', model=Organization, lookup='org_slug', lookup_field='slug', inject='org')\ndef org_dashboard(request, org_slug, org):\n    projects = org.projects.filter(is_archived=False)\n    return render(request, 'saas/org_dashboard.html', {\n        'org': org,\n        'projects': projects\n    })\n\n@guard('can_manage_org', model=Organization, lookup='org_slug', lookup_field='slug', inject='org')\ndef org_settings(request, org_slug, org):\n    if request.method == 'POST':\n        org.name = request.POST['name']\n        org.save()\n        return redirect('org_dashboard', org_slug=org.slug)\n    return render(request, 'saas/org_settings.html', {'org': org})\n\n@guard('can_invite_members', model=Organization, lookup='org_slug', lookup_field='slug', inject='org')\ndef member_invite(request, org_slug, org):\n    if request.method == 'POST':\n        # Invite logic here\n        ...\n    return render(request, 'saas/member_invite.html', {'org': org})\n\n@guard('is_org_admin', model=Organization, lookup='org_slug', lookup_field='slug', inject='org')\ndef member_list(request, org_slug, org):\n    members = org.memberships.select_related('user')\n    return render(request, 'saas/member_list.html', {\n        'org': org,\n        'members': members\n    })\n\n# Project views\n@guard('can_view_project', model=Project, inject='project')\ndef project_detail(request, pk, project):\n    tasks = project.tasks.all()\n    documents = project.documents.all()\n    return render(request, 'saas/project_detail.html', {\n        'project': project,\n        'tasks': tasks,\n        'documents': documents\n    })\n\n@guard('is_org_member', model=Organization, lookup='org_slug', lookup_field='slug', inject='org')\ndef project_create(request, org_slug, org):\n    role = get_user_role(request.user, org)\n    if role == 'viewer':\n        raise PermissionDenied(\"Viewers cannot create projects\")\n\n    if request.method == 'POST':\n        project = Project.objects.create(\n            organization=org,\n            name=request.POST['name'],\n            description=request.POST.get('description', ''),\n            created_by=request.user\n        )\n        return redirect('project_detail', pk=project.pk)\n    return render(request, 'saas/project_form.html', {'org': org})\n\n@guard('can_edit_project', model=Project, inject='project')\ndef project_edit(request, pk, project):\n    if request.method == 'POST':\n        project.name = request.POST['name']\n        project.description = request.POST.get('description', '')\n        project.save()\n        return redirect('project_detail', pk=project.pk)\n    return render(request, 'saas/project_form.html', {'project': project})\n\n@guard('can_archive_project', model=Project, inject='project')\ndef project_archive(request, pk, project):\n    project.is_archived = True\n    project.save()\n    return redirect('org_dashboard', org_slug=project.organization.slug)\n\n# Task views\n@guard('can_view_task', model=Task, inject='task')\ndef task_detail(request, pk, task):\n    return render(request, 'saas/task_detail.html', {'task': task})\n\n@guard('can_edit_project', model=Project, lookup='project_pk', inject='project')\ndef task_create(request, project_pk, project):\n    if request.method == 'POST':\n        task = Task.objects.create(\n            project=project,\n            title=request.POST['title'],\n            description=request.POST.get('description', ''),\n            created_by=request.user\n        )\n        return redirect('task_detail', pk=task.pk)\n    return render(request, 'saas/task_form.html', {'project': project})\n\n@guard('can_edit_task', model=Task, inject='task')\ndef task_edit(request, pk, task):\n    if request.method == 'POST':\n        task.title = request.POST['title']\n        task.description = request.POST.get('description', '')\n        task.save()\n        return redirect('task_detail', pk=task.pk)\n    return render(request, 'saas/task_form.html', {'task': task})\n\n@guard.any('is_task_assignee', 'can_assign_task', model=Task, inject='task')\ndef task_complete(request, pk, task):\n    task.is_completed = True\n    task.save()\n    return redirect('task_detail', pk=task.pk)\n\n# Document views\n@guard('can_view_document', model=Document, inject='document')\ndef document_detail(request, pk, document):\n    return render(request, 'saas/document_detail.html', {'document': document})\n\n@guard('can_edit_document', model=Document, inject='document')\ndef document_edit(request, pk, document):\n    if request.method == 'POST':\n        document.title = request.POST['title']\n        document.content = request.POST['content']\n        document.save()\n        return redirect('document_detail', pk=document.pk)\n    return render(request, 'saas/document_form.html', {'document': document})\n\n@guard('can_delete_document', model=Document, inject='document')\ndef document_delete(request, pk, document):\n    project_pk = document.project.pk\n    document.delete()\n    return redirect('project_detail', pk=project_pk)\n\n# Plan-based feature gates\n@guard.all('is_org_member', 'has_pro_plan', model=Organization, lookup='org_slug', lookup_field='slug')\ndef advanced_analytics(request, org_slug):\n    # Pro feature\n    ...\n\n@guard.all('is_org_admin', 'has_enterprise_plan', model=Organization, lookup='org_slug', lookup_field='slug')\ndef sso_settings(request, org_slug):\n    # Enterprise feature\n    ...\n</code></pre>"},{"location":"examples/saas/#expression-syntax-examples","title":"Expression Syntax Examples","text":"<pre><code># Role-based checks with helper\n@guard('is_org_admin', model=Organization, lookup='org_slug', lookup_field='slug')\ndef admin_panel(request, org_slug):\n    ...\n\n# Owner check\n@guard('obj.owner == user', model=Organization, lookup='org_slug', lookup_field='slug')\ndef org_billing(request, org_slug):\n    ...\n\n# Plan-based feature with membership check\n@guard.all('is_org_member', 'has_pro_plan', model=Organization)\ndef pro_feature(request, pk):\n    ...\n</code></pre>"},{"location":"examples/saas/#urls","title":"URLs","text":"<pre><code># urls.py\nfrom django.urls import path\nfrom . import views\n\nurlpatterns = [\n    # Organization\n    path('orgs/&lt;slug:org_slug&gt;/', views.org_dashboard, name='org_dashboard'),\n    path('orgs/&lt;slug:org_slug&gt;/settings/', views.org_settings, name='org_settings'),\n    path('orgs/&lt;slug:org_slug&gt;/members/', views.member_list, name='member_list'),\n    path('orgs/&lt;slug:org_slug&gt;/members/invite/', views.member_invite, name='member_invite'),\n\n    # Projects\n    path('orgs/&lt;slug:org_slug&gt;/projects/new/', views.project_create, name='project_create'),\n    path('projects/&lt;int:pk&gt;/', views.project_detail, name='project_detail'),\n    path('projects/&lt;int:pk&gt;/edit/', views.project_edit, name='project_edit'),\n    path('projects/&lt;int:pk&gt;/archive/', views.project_archive, name='project_archive'),\n\n    # Tasks\n    path('projects/&lt;int:project_pk&gt;/tasks/new/', views.task_create, name='task_create'),\n    path('tasks/&lt;int:pk&gt;/', views.task_detail, name='task_detail'),\n    path('tasks/&lt;int:pk&gt;/edit/', views.task_edit, name='task_edit'),\n    path('tasks/&lt;int:pk&gt;/complete/', views.task_complete, name='task_complete'),\n\n    # Documents\n    path('documents/&lt;int:pk&gt;/', views.document_detail, name='document_detail'),\n    path('documents/&lt;int:pk&gt;/edit/', views.document_edit, name='document_edit'),\n    path('documents/&lt;int:pk&gt;/delete/', views.document_delete, name='document_delete'),\n\n    # Plan-gated features\n    path('orgs/&lt;slug:org_slug&gt;/analytics/', views.advanced_analytics, name='advanced_analytics'),\n    path('orgs/&lt;slug:org_slug&gt;/sso/', views.sso_settings, name='sso_settings'),\n]\n</code></pre>"},{"location":"examples/saas/#role-hierarchy","title":"Role Hierarchy","text":"Role Permissions Owner Full access, billing, delete org Admin Manage members, all projects/tasks Member Create/edit projects and tasks Viewer Read-only access"},{"location":"examples/saas/#permission-summary","title":"Permission Summary","text":"Action Required Role/Condition View org dashboard Any member Manage org settings Owner only Invite members Owner, Admin Remove members Owner, Admin Create project Owner, Admin, Member Edit project Owner, Admin, Member Delete/archive project Owner, Admin View task Any member Edit task Owner, Admin, Member Complete task Assignee, or Admin+ View document Member, or public Edit document Owner, Admin, Member Delete document Creator, or Admin+ Advanced analytics Pro plan members SSO settings Enterprise Admins"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.10 or higher</li> <li>Django 4.2 or higher</li> </ul>"},{"location":"getting-started/installation/#install-from-github","title":"Install from GitHub","text":"<pre><code>pip install git+https://github.com/meinsoft/django-shield.git\n</code></pre>"},{"location":"getting-started/installation/#install-from-source","title":"Install from Source","text":"<p>Clone the repository and install in development mode:</p> <pre><code>git clone https://github.com/meinsoft/django-shield.git\ncd django-shield\npip install -e .\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>Open a Python shell and check the version:</p> <pre><code>import django_shield\nprint(django_shield.__version__)\n</code></pre> <p>You should see the version number (e.g., <code>0.2.1</code>).</p>"},{"location":"getting-started/installation/#no-configuration-needed","title":"No Configuration Needed","text":"<p>Django Shield works out of the box. You don't need to:</p> <ul> <li>Add it to <code>INSTALLED_APPS</code></li> <li>Run migrations</li> <li>Configure any settings</li> </ul> <p>Just import and use:</p> <pre><code>from django_shield import rule, guard\n</code></pre>"},{"location":"getting-started/installation/#optional-enable-debug-mode","title":"Optional: Enable Debug Mode","text":"<p>To see detailed permission logs during development, add this to your <code>settings.py</code>:</p> <pre><code>DJANGO_SHIELD = {\n    'DEBUG': True\n}\n</code></pre> <p>See Debug Mode for more details.</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<p>Continue to the Quick Start guide to create your first protected view.</p>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>This guide shows you how to protect Django views in 5 minutes.</p>"},{"location":"getting-started/quickstart/#step-1-create-a-rule","title":"Step 1: Create a Rule","text":"<p>A rule is a function that returns <code>True</code> if the user has permission.</p> <p>Create a file called <code>permissions.py</code> in your app:</p> <pre><code>from django_shield import rule\n\n@rule\ndef is_author(user, post):\n    \"\"\"Check if user is the author of the post.\"\"\"\n    return post.author == user\n</code></pre> <p>The <code>@rule</code> decorator registers this function. The function name becomes the rule name.</p>"},{"location":"getting-started/quickstart/#step-2-protect-a-view","title":"Step 2: Protect a View","text":"<p>Use the <code>@guard</code> decorator to protect your view:</p> <pre><code>from django_shield import guard\nfrom .models import Post\n\n@guard('is_author', model=Post, lookup='pk')\ndef edit_post(request, pk):\n    post = Post.objects.get(pk=pk)\n    # User has permission if they reach here\n    return render(request, 'posts/edit.html', {'post': post})\n</code></pre> <p>What happens:</p> <ol> <li>Django Shield fetches the <code>Post</code> using <code>pk</code> from the URL</li> <li>It calls <code>is_author(request.user, post)</code></li> <li>If <code>True</code>, the view runs</li> <li>If <code>False</code>, it raises <code>PermissionDenied</code></li> </ol>"},{"location":"getting-started/quickstart/#step-3-use-expression-syntax","title":"Step 3: Use Expression Syntax","text":"<p>For simple checks, you can skip creating a rule function:</p> <pre><code>@guard('obj.author == user', model=Post)\ndef edit_post(request, pk):\n    ...\n</code></pre> <p>Or combine multiple conditions:</p> <pre><code>@guard('obj.author == user or user.is_staff', model=Post)\ndef edit_post(request, pk):\n    ...\n</code></pre>"},{"location":"getting-started/quickstart/#step-4-test-in-browser","title":"Step 4: Test in Browser","text":"<ol> <li> <p>Make sure your rule file is imported (add it to your app's <code>__init__.py</code> or import in <code>views.py</code>)</p> </li> <li> <p>Create a URL pattern:</p> </li> </ol> <pre><code># urls.py\nfrom django.urls import path\nfrom . import views\n\nurlpatterns = [\n    path('posts/&lt;int:pk&gt;/edit/', views.edit_post, name='edit_post'),\n]\n</code></pre> <ol> <li>Try to access a post you own - it works</li> <li>Try to access a post you don't own - you get 403 Forbidden</li> </ol>"},{"location":"getting-started/quickstart/#step-5-auto-inject-objects","title":"Step 5: Auto-inject Objects","text":"<p>Avoid fetching the object twice by using <code>inject</code>:</p> <pre><code>@guard('is_author', model=Post, lookup='pk', inject='post')\ndef edit_post(request, pk, post):\n    # 'post' is passed automatically, no extra query needed\n    return render(request, 'posts/edit.html', {'post': post})\n</code></pre>"},{"location":"getting-started/quickstart/#complete-example","title":"Complete Example","text":"<pre><code># permissions.py\nfrom django_shield import rule\n\n@rule\ndef is_author(user, post):\n    return post.author == user\n\n@rule\ndef is_staff(user):\n    return user.is_staff\n</code></pre> <pre><code># views.py\nfrom django_shield import guard\nfrom .models import Post\n\n# Only post author can edit\n@guard('is_author', model=Post, inject='post')\ndef edit_post(request, pk, post):\n    ...\n\n# Only staff can delete\n@guard('is_staff')\ndef delete_all_posts(request):\n    ...\n\n# Author or staff can view drafts\n@guard('obj.author == user or user.is_staff', model=Post)\ndef view_draft(request, pk):\n    ...\n</code></pre>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Rules - Learn all about defining rules</li> <li>Guard Decorator - All <code>@guard</code> options explained</li> <li>Expression Syntax - Write inline permission checks</li> </ul>"},{"location":"guide/cbv/","title":"Class-based Views","text":"<p>Django Shield works with class-based views (CBVs) just like function-based views.</p>"},{"location":"guide/cbv/#basic-usage","title":"Basic Usage","text":"<p>Apply <code>@guard</code> to the class:</p> <pre><code>from django.views import View\nfrom django.http import HttpResponse\nfrom django_shield import guard\n\n@guard('user.is_staff')\nclass AdminDashboard(View):\n    def get(self, request):\n        return HttpResponse(\"Admin Dashboard\")\n</code></pre> <p>The decorator wraps the <code>dispatch</code> method, so all HTTP methods are protected.</p>"},{"location":"guide/cbv/#how-it-works","title":"How It Works","text":"<p>When you decorate a CBV:</p> <ol> <li>Django Shield wraps the <code>dispatch</code> method</li> <li>Before any request handling, it checks permissions</li> <li>If denied, raises <code>PermissionDenied</code></li> <li>If allowed, continues to <code>get()</code>, <code>post()</code>, etc.</li> </ol>"},{"location":"guide/cbv/#object-level-permissions","title":"Object-level Permissions","text":""},{"location":"guide/cbv/#using-get_object","title":"Using get_object()","text":"<p>Django Shield automatically uses your view's <code>get_object()</code> method:</p> <pre><code>from django.views.generic import DetailView\nfrom django_shield import guard, rule\nfrom .models import Post\n\n@rule\ndef is_author(user, post):\n    return post.author == user\n\n@guard('is_author')\nclass PostEditView(DetailView):\n    model = Post\n\n    def get_object(self):\n        return Post.objects.get(pk=self.kwargs['pk'])\n\n    def get(self, request, *args, **kwargs):\n        post = self.get_object()\n        # User has permission if they reach here\n        ...\n</code></pre> <p>Django Shield:</p> <ol> <li>Calls <code>get_object()</code> to get the post</li> <li>Passes it to <code>is_author(user, post)</code></li> <li>Allows or denies based on the result</li> </ol>"},{"location":"guide/cbv/#with-expression-syntax","title":"With Expression Syntax","text":"<pre><code>@guard('obj.author == user')\nclass PostEditView(DetailView):\n    model = Post\n\n    def get_object(self):\n        return Post.objects.get(pk=self.kwargs['pk'])\n\n    def get(self, request, *args, **kwargs):\n        ...\n</code></pre>"},{"location":"guide/cbv/#views-without-objects","title":"Views Without Objects","text":"<p>For list views or views without a specific object:</p> <pre><code>from django.views.generic import ListView\nfrom django_shield import guard\n\n@guard('user.is_authenticated')\nclass PostListView(ListView):\n    model = Post\n    template_name = 'posts/list.html'\n</code></pre> <p>Rules receive <code>None</code> as the object:</p> <pre><code>@rule\ndef is_premium_user(user, obj=None):\n    # obj is None for list views\n    return user.subscription.is_active\n</code></pre>"},{"location":"guide/cbv/#generic-views","title":"Generic Views","text":""},{"location":"guide/cbv/#detailview","title":"DetailView","text":"<pre><code>from django.views.generic import DetailView\nfrom django_shield import guard\n\n@guard('obj.author == user or obj.is_public')\nclass PostDetailView(DetailView):\n    model = Post\n    template_name = 'posts/detail.html'\n</code></pre>"},{"location":"guide/cbv/#updateview","title":"UpdateView","text":"<pre><code>from django.views.generic import UpdateView\nfrom django_shield import guard\n\n@guard('obj.author == user')\nclass PostUpdateView(UpdateView):\n    model = Post\n    fields = ['title', 'content']\n    template_name = 'posts/edit.html'\n</code></pre>"},{"location":"guide/cbv/#deleteview","title":"DeleteView","text":"<pre><code>from django.views.generic import DeleteView\nfrom django_shield import guard\n\n@guard('obj.author == user or user.is_staff')\nclass PostDeleteView(DeleteView):\n    model = Post\n    success_url = '/posts/'\n</code></pre>"},{"location":"guide/cbv/#createview","title":"CreateView","text":"<p>Create views don't have an object yet:</p> <pre><code>from django.views.generic import CreateView\nfrom django_shield import guard\n\n@guard('user.is_authenticated')\nclass PostCreateView(CreateView):\n    model = Post\n    fields = ['title', 'content']\n</code></pre>"},{"location":"guide/cbv/#listview","title":"ListView","text":"<pre><code>from django.views.generic import ListView\nfrom django_shield import guard\n\n@guard('user.is_staff')\nclass AllPostsView(ListView):\n    model = Post\n    template_name = 'posts/admin_list.html'\n</code></pre>"},{"location":"guide/cbv/#combining-multiple-rules","title":"Combining Multiple Rules","text":""},{"location":"guide/cbv/#guardall","title":"guard.all()","text":"<p>All rules must pass:</p> <pre><code>@guard.all('is_authenticated', 'is_verified', 'is_active')\nclass SecureView(View):\n    def get(self, request):\n        ...\n</code></pre> <p>With objects:</p> <pre><code>@guard.all('is_team_member', 'has_edit_permission')\nclass ProjectEditView(UpdateView):\n    model = Project\n\n    def get_object(self):\n        return Project.objects.get(pk=self.kwargs['pk'])\n</code></pre>"},{"location":"guide/cbv/#guardany","title":"guard.any()","text":"<p>At least one rule must pass:</p> <pre><code>@guard.any('is_owner', 'is_admin', 'is_editor')\nclass ContentManageView(View):\n    def get(self, request):\n        ...\n</code></pre>"},{"location":"guide/cbv/#error-handling-in-get_object","title":"Error Handling in get_object()","text":"<p>If <code>get_object()</code> raises an exception, Django Shield continues without an object:</p> <pre><code>@guard('is_admin')  # Rule only checks user\nclass SafeView(DetailView):\n    model = Post\n\n    def get_object(self):\n        # If this fails, permission check runs with obj=None\n        raise Http404(\"Not found\")\n</code></pre> <p>This is useful when you want to check user-level permissions even if the object doesn't exist.</p>"},{"location":"guide/cbv/#complete-example","title":"Complete Example","text":"<pre><code>from django.views.generic import DetailView, UpdateView, DeleteView, ListView\nfrom django_shield import guard, rule\nfrom .models import Post\n\n# Define rules\n@rule\ndef is_author(user, post):\n    return post.author == user\n\n@rule\ndef can_view(user, post):\n    return post.is_published or post.author == user\n\n# List all published posts - anyone can view\nclass PostListView(ListView):\n    model = Post\n    queryset = Post.objects.filter(is_published=True)\n\n# View single post - must be published or owner\n@guard('can_view')\nclass PostDetailView(DetailView):\n    model = Post\n\n# Edit post - must be author\n@guard('is_author')\nclass PostEditView(UpdateView):\n    model = Post\n    fields = ['title', 'content']\n\n# Delete post - must be author or staff\n@guard('obj.author == user or user.is_staff')\nclass PostDeleteView(DeleteView):\n    model = Post\n    success_url = '/posts/'\n\n# Admin view - staff only\n@guard('user.is_staff')\nclass PostAdminView(ListView):\n    model = Post\n    template_name = 'posts/admin.html'\n</code></pre>"},{"location":"guide/cbv/#mixins-vs-decorators","title":"Mixins vs Decorators","text":"<p>You might be used to Django's <code>LoginRequiredMixin</code>. Django Shield uses decorators instead of mixins for consistency between function-based and class-based views.</p> <pre><code># Django's approach with mixin\nclass MyView(LoginRequiredMixin, View):\n    ...\n\n# Django Shield approach with decorator\n@guard('user.is_authenticated')\nclass MyView(View):\n    ...\n</code></pre> <p>Both approaches work. Use whichever fits your codebase.</p>"},{"location":"guide/debug/","title":"Debug Mode","text":"<p>Debug mode shows detailed logs of permission checks. Use it during development to understand why permissions pass or fail.</p>"},{"location":"guide/debug/#enabling-debug-mode","title":"Enabling Debug Mode","text":"<p>Add to your <code>settings.py</code>:</p> <pre><code>DJANGO_SHIELD = {\n    'DEBUG': True\n}\n</code></pre> <p>Only enable this in development. Disable in production.</p>"},{"location":"guide/debug/#what-gets-logged","title":"What Gets Logged","text":"<p>When debug mode is enabled, every permission check logs:</p> <ol> <li>The rule or expression being checked</li> <li>User information (username, ID)</li> <li>Object information (if any)</li> <li>The result (ALLOWED or DENIED)</li> </ol>"},{"location":"guide/debug/#log-output","title":"Log Output","text":"<p>Example output when checking permissions:</p> <pre><code>[Django Shield] Checking: is_author\n[Django Shield] User: john (id=1)\n[Django Shield] Object: Post \"My First Post\" (id=42)\n[Django Shield] Result: ALLOWED\n</code></pre> <p>When permission is denied:</p> <pre><code>[Django Shield] Checking: is_admin\n[Django Shield] User: jane (id=2)\n[Django Shield] Object: None\n[Django Shield] Result: DENIED\n</code></pre>"},{"location":"guide/debug/#multiple-rules","title":"Multiple Rules","text":"<p>With <code>guard.all()</code>:</p> <pre><code>[Django Shield] Checking: is_authenticated\n[Django Shield] User: john (id=1)\n[Django Shield] Object: None\n[Django Shield] Result: ALLOWED\n[Django Shield] Checking: is_verified\n[Django Shield] User: john (id=1)\n[Django Shield] Object: None\n[Django Shield] Result: DENIED\n</code></pre> <p>With <code>guard.any()</code>:</p> <pre><code>[Django Shield] Checking: is_owner\n[Django Shield] User: john (id=1)\n[Django Shield] Object: Document \"Report\" (id=5)\n[Django Shield] Result: DENIED\n[Django Shield] Checking: is_admin\n[Django Shield] User: john (id=1)\n[Django Shield] Object: Document \"Report\" (id=5)\n[Django Shield] Result: ALLOWED\n</code></pre>"},{"location":"guide/debug/#environment-based-configuration","title":"Environment-based Configuration","text":"<p>Enable debug mode only in development:</p> <pre><code># settings.py\nimport os\n\nDJANGO_SHIELD = {\n    'DEBUG': os.environ.get('DJANGO_SHIELD_DEBUG', 'false').lower() == 'true'\n}\n</code></pre> <p>Or use Django's DEBUG setting:</p> <pre><code># settings.py\nDJANGO_SHIELD = {\n    'DEBUG': DEBUG  # Uses Django's DEBUG setting\n}\n</code></pre>"},{"location":"guide/debug/#tips-for-debugging","title":"Tips for Debugging","text":""},{"location":"guide/debug/#1-check-user-attributes","title":"1. Check User Attributes","text":"<p>If permissions fail unexpectedly, log user attributes:</p> <pre><code>@rule\ndef is_verified(user):\n    print(f\"User verified: {user.email_verified}\")  # Debug\n    return user.email_verified\n</code></pre>"},{"location":"guide/debug/#2-check-object-state","title":"2. Check Object State","text":"<p>Verify the object has expected values:</p> <pre><code>@rule\ndef is_author(user, post):\n    print(f\"Post author: {post.author}, User: {user}\")  # Debug\n    return post.author == user\n</code></pre>"},{"location":"guide/debug/#3-test-rules-directly","title":"3. Test Rules Directly","text":"<p>Test rules without HTTP requests:</p> <pre><code>from myapp.permissions import is_author\nfrom myapp.models import Post\nfrom django.contrib.auth import get_user_model\n\nUser = get_user_model()\nuser = User.objects.get(pk=1)\npost = Post.objects.get(pk=42)\n\n# Check the rule directly\nresult = is_author.predicate(user, post)\nprint(f\"is_author: {result}\")\n</code></pre>"},{"location":"guide/debug/#4-use-django-shell","title":"4. Use Django Shell","text":"<p>Test permissions interactively:</p> <pre><code>python manage.py shell\n</code></pre> <pre><code>from django_shield import RuleRegistry\n\nrule = RuleRegistry.get('is_author')\nprint(rule.check(user, post))\n</code></pre>"},{"location":"guide/debug/#production-considerations","title":"Production Considerations","text":"<p>Always disable debug mode in production:</p> <ol> <li>Security: Logs may contain sensitive information</li> <li>Performance: Logging adds overhead</li> <li>Log volume: High traffic creates massive logs</li> </ol> <pre><code># settings/production.py\nDJANGO_SHIELD = {\n    'DEBUG': False\n}\n</code></pre> <p>Or ensure the setting doesn't exist:</p> <pre><code># No DJANGO_SHIELD setting = debug disabled\n</code></pre>"},{"location":"guide/expressions/","title":"Expression Syntax","text":"<p>Expression syntax lets you write permission checks inline without defining rule functions.</p>"},{"location":"guide/expressions/#what-is-expression-syntax","title":"What is Expression Syntax?","text":"<p>Instead of creating a rule function:</p> <pre><code>@rule\ndef is_author(user, post):\n    return post.author == user\n\n@guard('is_author', model=Post)\ndef edit_post(request, pk):\n    ...\n</code></pre> <p>You can write the check directly:</p> <pre><code>@guard('obj.author == user', model=Post)\ndef edit_post(request, pk):\n    ...\n</code></pre>"},{"location":"guide/expressions/#when-to-use-expressions","title":"When to Use Expressions","text":"<p>Use expressions when:</p> <ul> <li>The check is simple (one or two conditions)</li> <li>The rule is used in only one place</li> <li>You want quick prototyping</li> </ul> <p>Use named rules when:</p> <ul> <li>The logic is complex</li> <li>The same check is used in multiple views</li> <li>You want to test rules in isolation</li> </ul>"},{"location":"guide/expressions/#attribute-access","title":"Attribute Access","text":""},{"location":"guide/expressions/#object-attributes","title":"Object Attributes","text":"<p>Access object fields with <code>obj.</code>:</p> <pre><code>@guard('obj.status == \"published\"', model=Post)\ndef view_post(request, pk):\n    ...\n\n@guard('obj.is_active', model=User)\ndef view_profile(request, user_id):\n    ...\n</code></pre>"},{"location":"guide/expressions/#nested-attributes","title":"Nested Attributes","text":"<p>Chain attributes with dots:</p> <pre><code># obj.author.name\n@guard('obj.author.name == \"admin\"', model=Post)\n\n# obj.category.parent.slug\n@guard('obj.category.parent.slug == \"tech\"', model=Article)\n</code></pre>"},{"location":"guide/expressions/#user-attributes","title":"User Attributes","text":"<p>Access user fields with <code>user.</code>:</p> <pre><code>@guard('user.is_staff')\ndef admin_view(request):\n    ...\n\n@guard('user.profile.is_verified')\ndef verified_only(request):\n    ...\n</code></pre>"},{"location":"guide/expressions/#the-user-reference","title":"The user Reference","text":"<p>Use <code>user</code> alone to reference the entire user object:</p> <pre><code>@guard('obj.author == user', model=Post)\ndef edit_post(request, pk):\n    ...\n\n@guard('obj.owner == user', model=Document)\ndef view_document(request, pk):\n    ...\n</code></pre>"},{"location":"guide/expressions/#comparison-operators","title":"Comparison Operators","text":"Operator Description Example <code>==</code> Equal <code>obj.status == \"active\"</code> <code>!=</code> Not equal <code>obj.status != \"deleted\"</code> <code>&gt;</code> Greater than <code>obj.priority &gt; 5</code> <code>&lt;</code> Less than <code>obj.count &lt; 100</code> <code>&gt;=</code> Greater or equal <code>obj.age &gt;= 18</code> <code>&lt;=</code> Less or equal <code>obj.price &lt;= 1000</code>"},{"location":"guide/expressions/#examples","title":"Examples","text":"<pre><code># String comparison\n@guard('obj.status == \"published\"', model=Post)\n\n# Number comparison\n@guard('obj.view_count &gt; 1000', model=Article)\n\n# User field comparison\n@guard('obj.author.id == user.id', model=Post)\n</code></pre>"},{"location":"guide/expressions/#boolean-operators","title":"Boolean Operators","text":""},{"location":"guide/expressions/#and","title":"and","text":"<p>Both conditions must be true:</p> <pre><code>@guard('user.is_authenticated and user.is_active')\ndef dashboard(request):\n    ...\n\n@guard('obj.author == user and obj.status == \"draft\"', model=Post)\ndef edit_draft(request, pk):\n    ...\n</code></pre>"},{"location":"guide/expressions/#or","title":"or","text":"<p>At least one condition must be true:</p> <pre><code>@guard('user.is_staff or user.is_superuser')\ndef admin_area(request):\n    ...\n\n@guard('obj.author == user or obj.is_public', model=Document)\ndef view_document(request, pk):\n    ...\n</code></pre>"},{"location":"guide/expressions/#not","title":"not","text":"<p>Negates a condition:</p> <pre><code>@guard('not user.is_banned')\ndef post_comment(request):\n    ...\n\n@guard('user.is_staff and not obj.is_locked', model=Post)\ndef edit_post(request, pk):\n    ...\n</code></pre>"},{"location":"guide/expressions/#operator-precedence","title":"Operator Precedence","text":"<p>Precedence from highest to lowest:</p> <ol> <li><code>not</code></li> <li><code>and</code></li> <li><code>or</code></li> </ol> <p>This means <code>a or b and c</code> is evaluated as <code>a or (b and c)</code>.</p> <p>Use parentheses to change precedence:</p> <pre><code># Without parentheses: is_admin or (is_author and is_active)\n@guard('is_admin or is_author and is_active')\n\n# With parentheses: (is_admin or is_author) and is_active\n@guard('(is_admin or is_author) and is_active')\n</code></pre>"},{"location":"guide/expressions/#list-membership-with-in","title":"List Membership with in","text":"<p>Check if a value is in a list:</p> <pre><code>@guard('obj.status in [\"draft\", \"review\"]', model=Post)\ndef edit_pending(request, pk):\n    ...\n\n@guard('obj.priority in [1, 2, 3]', model=Task)\ndef handle_urgent(request, pk):\n    ...\n\n@guard('user.role in [\"admin\", \"moderator\", \"editor\"]')\ndef manage_content(request):\n    ...\n</code></pre>"},{"location":"guide/expressions/#empty-lists","title":"Empty Lists","text":"<pre><code># Always false - nothing is in an empty list\n@guard('obj.status in []', model=Post)\n</code></pre>"},{"location":"guide/expressions/#null-comparison","title":"Null Comparison","text":"<p>Check for null/None values:</p> <pre><code>@guard('obj.deleted_at == null', model=Post)\ndef view_post(request, pk):\n    ...\n\n@guard('obj.parent != null', model=Category)\ndef view_subcategory(request, pk):\n    ...\n</code></pre> <p>You can use <code>null</code> or <code>None</code>:</p> <pre><code># These are equivalent\n@guard('obj.deleted_at == null', model=Post)\n@guard('obj.deleted_at == None', model=Post)\n</code></pre>"},{"location":"guide/expressions/#literal-values","title":"Literal Values","text":""},{"location":"guide/expressions/#strings","title":"Strings","text":"<p>Use double quotes:</p> <pre><code>@guard('obj.status == \"published\"', model=Post)\n@guard('obj.type == \"premium\"', model=Account)\n</code></pre>"},{"location":"guide/expressions/#numbers","title":"Numbers","text":"<p>Integers and floats:</p> <pre><code>@guard('obj.count &gt; 100', model=Post)\n@guard('obj.price &lt;= 99.99', model=Product)\n@guard('obj.discount &gt;= 0.5', model=Coupon)\n</code></pre> <p>Negative numbers:</p> <pre><code>@guard('obj.balance &gt; -100', model=Account)\n</code></pre>"},{"location":"guide/expressions/#booleans","title":"Booleans","text":"<p>Use <code>true</code>/<code>false</code> or <code>True</code>/<code>False</code>:</p> <pre><code>@guard('obj.is_active == true', model=User)\n@guard('obj.is_featured == True', model=Post)\n@guard('user.is_verified == false')\n</code></pre>"},{"location":"guide/expressions/#mixing-rules-and-expressions","title":"Mixing Rules and Expressions","text":"<p>You can use named rules inside expressions:</p> <pre><code>@rule\ndef is_admin(user, obj=None):\n    return user.is_superuser\n\n# Mix rule with expression\n@guard('is_admin or obj.author == user', model=Post)\ndef edit_post(request, pk):\n    ...\n</code></pre>"},{"location":"guide/expressions/#complex-examples","title":"Complex Examples","text":""},{"location":"guide/expressions/#blog-post-access","title":"Blog Post Access","text":"<pre><code># View: published or author\n@guard('obj.status == \"published\" or obj.author == user', model=Post)\n\n# Edit: author and not locked\n@guard('obj.author == user and not obj.is_locked', model=Post)\n\n# Delete: admin or (author and draft)\n@guard('user.is_superuser or (obj.author == user and obj.status == \"draft\")', model=Post)\n</code></pre>"},{"location":"guide/expressions/#e-commerce","title":"E-commerce","text":"<pre><code># View order: owner or staff\n@guard('obj.customer == user or user.is_staff', model=Order)\n\n# Cancel order: owner and pending\n@guard('obj.customer == user and obj.status in [\"pending\", \"processing\"]', model=Order)\n\n# Refund: staff and not already refunded\n@guard('user.is_staff and obj.refund_status == null', model=Order)\n</code></pre>"},{"location":"guide/expressions/#team-collaboration","title":"Team Collaboration","text":"<pre><code># View project: member or public\n@guard('obj.is_public or user in obj.members', model=Project)\n\n# Edit project: owner or admin role\n@guard('obj.owner == user or user.role == \"admin\"', model=Project)\n</code></pre>"},{"location":"guide/expressions/#error-messages","title":"Error Messages","text":"<p>When an expression has a syntax error, Django Shield shows the error location:</p> <pre><code>@guard('obj.status == == \"draft\"', model=Post)  # Syntax error\n</code></pre> <pre><code>ExpressionSyntaxError: Unexpected token '=='\n  obj.status == == \"draft\"\n               ^\n</code></pre> <p>When evaluation fails:</p> <pre><code>@guard('nonexistent_rule', model=Post)\n</code></pre> <pre><code>ExpressionEvaluationError: Rule not found: Rule 'nonexistent_rule' is not registered\n</code></pre>"},{"location":"guide/guard/","title":"Guard Decorator","text":"<p>The <code>@guard</code> decorator protects views by checking permissions before the view runs.</p>"},{"location":"guide/guard/#basic-usage","title":"Basic Usage","text":"<pre><code>from django_shield import guard\n\n@guard('is_authenticated')\ndef my_view(request):\n    # Only authenticated users reach here\n    ...\n</code></pre> <p>If the check fails, Django Shield raises <code>PermissionDenied</code> (HTTP 403).</p>"},{"location":"guide/guard/#parameters","title":"Parameters","text":"Parameter Type Default Description <code>rule_name</code> str required Rule name or expression to check <code>model</code> Model <code>None</code> Django model class to fetch <code>lookup</code> str <code>'pk'</code> URL parameter name to get lookup value <code>lookup_field</code> str <code>'pk'</code> Model field to query <code>inject</code> str <code>None</code> Parameter name to pass object to view"},{"location":"guide/guard/#using-with-rules","title":"Using with Rules","text":"<p>First, define a rule:</p> <pre><code>from django_shield import rule\n\n@rule\ndef is_staff(user):\n    return user.is_staff\n</code></pre> <p>Then protect a view:</p> <pre><code>@guard('is_staff')\ndef admin_panel(request):\n    ...\n</code></pre>"},{"location":"guide/guard/#using-with-expressions","title":"Using with Expressions","text":"<p>You can use inline expressions instead of named rules:</p> <pre><code>@guard('user.is_staff')\ndef admin_panel(request):\n    ...\n\n@guard('user.is_authenticated and user.is_active')\ndef dashboard(request):\n    ...\n</code></pre>"},{"location":"guide/guard/#fetching-objects-with-model","title":"Fetching Objects with <code>model</code>","text":"<p>When protecting views that work with specific objects, use the <code>model</code> parameter:</p> <pre><code>from .models import Post\n\n@guard('is_author', model=Post)\ndef edit_post(request, pk):\n    post = Post.objects.get(pk=pk)\n    ...\n</code></pre> <p>Django Shield:</p> <ol> <li>Gets <code>pk</code> from URL parameters</li> <li>Fetches <code>Post.objects.get(pk=pk)</code></li> <li>Passes the post to your rule</li> <li>Runs the view if allowed</li> </ol>"},{"location":"guide/guard/#custom-url-parameter-with-lookup","title":"Custom URL Parameter with <code>lookup</code>","text":"<p>If your URL uses a different parameter name:</p> <pre><code># URL: /posts/&lt;int:post_id&gt;/edit/\n@guard('is_author', model=Post, lookup='post_id')\ndef edit_post(request, post_id):\n    ...\n</code></pre>"},{"location":"guide/guard/#custom-model-field-with-lookup_field","title":"Custom Model Field with <code>lookup_field</code>","text":"<p>To query by a field other than <code>pk</code>:</p> <pre><code># URL: /posts/&lt;slug:slug&gt;/edit/\n@guard('is_author', model=Post, lookup='slug', lookup_field='slug')\ndef edit_post(request, slug):\n    ...\n</code></pre> <p>This runs <code>Post.objects.get(slug=slug)</code>.</p>"},{"location":"guide/guard/#combining-lookup-and-lookup_field","title":"Combining lookup and lookup_field","text":"<p>When URL parameter name differs from model field:</p> <pre><code># URL: /articles/&lt;str:article_slug&gt;/\n@guard('is_author', model=Post, lookup='article_slug', lookup_field='slug')\ndef edit_post(request, article_slug):\n    ...\n</code></pre> <p>This takes <code>article_slug</code> from URL and queries <code>Post.objects.get(slug=article_slug)</code>.</p>"},{"location":"guide/guard/#auto-inject-objects-with-inject","title":"Auto-inject Objects with <code>inject</code>","text":"<p>Avoid fetching the object twice:</p> <pre><code># Without inject - object fetched twice\n@guard('is_author', model=Post)\ndef edit_post(request, pk):\n    post = Post.objects.get(pk=pk)  # Second query\n    ...\n\n# With inject - object passed to view\n@guard('is_author', model=Post, inject='post')\ndef edit_post(request, pk, post):\n    # 'post' is already fetched, no extra query\n    ...\n</code></pre> <p>The injected object is passed as a keyword argument.</p>"},{"location":"guide/guard/#guardall-all-rules-must-pass","title":"guard.all() - All Rules Must Pass","text":"<p>Use when every condition must be true:</p> <pre><code>@guard.all('is_authenticated', 'is_verified', 'is_active')\ndef secure_action(request):\n    ...\n</code></pre> <p>With objects:</p> <pre><code>@guard.all('is_team_member', 'has_edit_permission', model=Project)\ndef edit_project(request, pk):\n    ...\n</code></pre> <p>If any rule fails, the request is denied. The exception includes which rule failed.</p>"},{"location":"guide/guard/#guardany-at-least-one-rule-must-pass","title":"guard.any() - At Least One Rule Must Pass","text":"<p>Use when any condition is sufficient:</p> <pre><code>@guard.any('is_owner', 'is_admin', 'is_moderator')\ndef manage_content(request):\n    ...\n</code></pre> <p>With objects:</p> <pre><code>@guard.any('is_author', 'is_editor', 'is_admin', model=Post)\ndef edit_post(request, pk):\n    ...\n</code></pre> <p>If all rules fail, the request is denied.</p>"},{"location":"guide/guard/#error-handling","title":"Error Handling","text":"<p>When permission is denied, Django Shield raises <code>PermissionDenied</code>:</p> <pre><code>from django_shield.exceptions import PermissionDenied\n\ntry:\n    # Call a guarded view or check manually\n    ...\nexcept PermissionDenied as e:\n    print(f\"Rule failed: {e.rule_name}\")\n    print(f\"User: {e.user}\")\n    print(f\"Object: {e.obj}\")\n</code></pre> <p>The exception contains:</p> Attribute Description <code>rule_name</code> Name of the failed rule <code>user</code> The user who was denied <code>obj</code> The object (if any) that was checked"},{"location":"guide/guard/#handling-404-vs-403","title":"Handling 404 vs 403","text":"<p>When an object is not found, Django Shield raises Django's <code>PermissionDenied</code> (403) instead of <code>Http404</code>. This prevents information disclosure about which IDs exist.</p> <p>To customize this behavior, catch the exception in middleware or use a custom view.</p>"},{"location":"guide/guard/#complete-examples","title":"Complete Examples","text":""},{"location":"guide/guard/#blog-post-permissions","title":"Blog Post Permissions","text":"<pre><code>from django_shield import rule, guard\nfrom .models import Post\n\n@rule\ndef is_author(user, post):\n    return post.author == user\n\n@rule\ndef is_published(user, post):\n    return post.status == 'published'\n\n# Author can edit their posts\n@guard('is_author', model=Post, inject='post')\ndef edit_post(request, pk, post):\n    ...\n\n# Anyone can view published posts, author can view their own drafts\n@guard.any('is_published', 'is_author', model=Post)\ndef view_post(request, pk):\n    ...\n\n# Only staff can delete\n@guard('user.is_staff')\ndef delete_posts(request):\n    ...\n</code></pre>"},{"location":"guide/guard/#e-commerce-order-permissions","title":"E-commerce Order Permissions","text":"<pre><code>from django_shield import rule, guard\nfrom .models import Order\n\n@rule\ndef is_order_owner(user, order):\n    return order.customer == user\n\n@rule\ndef can_cancel_order(user, order):\n    return order.customer == user and order.status == 'pending'\n\n# View own orders\n@guard('is_order_owner', model=Order, inject='order')\ndef view_order(request, order_id, order):\n    ...\n\n# Cancel pending orders\n@guard('can_cancel_order', model=Order, lookup='order_id')\ndef cancel_order(request, order_id):\n    ...\n</code></pre>"},{"location":"guide/rules/","title":"Rules","text":"<p>Rules are the core building blocks of Django Shield. A rule is a function that checks if a user has permission.</p>"},{"location":"guide/rules/#what-is-a-rule","title":"What is a Rule?","text":"<p>A rule is a Python function that:</p> <ul> <li>Takes <code>user</code> as the first parameter</li> <li>Optionally takes an object as the second parameter</li> <li>Returns <code>True</code> (allowed) or <code>False</code> (denied)</li> </ul>"},{"location":"guide/rules/#the-rule-decorator","title":"The @rule Decorator","text":"<p>Use <code>@rule</code> to register a permission function:</p> <pre><code>from django_shield import rule\n\n@rule\ndef is_authenticated(user):\n    return user.is_authenticated\n</code></pre> <p>The function name becomes the rule name. You can use this name with <code>@guard</code>:</p> <pre><code>@guard('is_authenticated')\ndef my_view(request):\n    ...\n</code></pre>"},{"location":"guide/rules/#rules-without-object","title":"Rules Without Object","text":"<p>Some rules only need the user:</p> <pre><code>@rule\ndef is_staff(user):\n    return user.is_staff\n\n@rule\ndef is_superuser(user):\n    return user.is_superuser\n\n@rule\ndef is_verified(user):\n    return user.email_verified\n</code></pre> <p>Use these for views that don't operate on a specific object:</p> <pre><code>@guard('is_staff')\ndef admin_dashboard(request):\n    ...\n</code></pre>"},{"location":"guide/rules/#rules-with-object","title":"Rules With Object","text":"<p>Most rules check if a user can access a specific object:</p> <pre><code>@rule\ndef is_author(user, post):\n    return post.author == user\n\n@rule\ndef can_view_document(user, document):\n    return document.is_public or document.owner == user\n\n@rule\ndef is_team_member(user, project):\n    return user in project.team.members.all()\n</code></pre> <p>Use with the <code>model</code> parameter:</p> <pre><code>@guard('is_author', model=Post)\ndef edit_post(request, pk):\n    ...\n</code></pre>"},{"location":"guide/rules/#custom-rule-names","title":"Custom Rule Names","text":"<p>By default, the function name is the rule name. Use <code>name</code> to set a custom name:</p> <pre><code>@rule(name='can_edit')\ndef check_edit_permission(user, obj):\n    return obj.author == user or user.is_staff\n</code></pre> <p>Now use <code>'can_edit'</code> instead of <code>'check_edit_permission'</code>:</p> <pre><code>@guard('can_edit', model=Post)\ndef edit_view(request, pk):\n    ...\n</code></pre>"},{"location":"guide/rules/#accessing-rules-from-registry","title":"Accessing Rules from Registry","text":"<p>You can access registered rules programmatically:</p> <pre><code>from django_shield import RuleRegistry\n\n# Check if a rule exists\nif RuleRegistry.exists('is_author'):\n    rule = RuleRegistry.get('is_author')\n    result = rule.check(user, post)\n</code></pre>"},{"location":"guide/rules/#combining-rules","title":"Combining Rules","text":""},{"location":"guide/rules/#using-guardall","title":"Using guard.all()","text":"<p>All rules must pass:</p> <pre><code>@guard.all('is_authenticated', 'is_verified', 'is_active')\ndef secure_view(request):\n    ...\n</code></pre>"},{"location":"guide/rules/#using-guardany","title":"Using guard.any()","text":"<p>At least one rule must pass:</p> <pre><code>@guard.any('is_author', 'is_staff', 'is_superuser')\ndef edit_post(request, pk):\n    ...\n</code></pre>"},{"location":"guide/rules/#combining-in-expression-syntax","title":"Combining in Expression Syntax","text":"<p>Use <code>and</code>, <code>or</code>, <code>not</code>:</p> <pre><code>@guard('is_author or is_staff')\ndef edit_post(request, pk):\n    ...\n\n@guard('is_authenticated and not is_banned')\ndef post_comment(request):\n    ...\n</code></pre>"},{"location":"guide/rules/#best-practices","title":"Best Practices","text":""},{"location":"guide/rules/#1-keep-rules-simple","title":"1. Keep Rules Simple","text":"<p>Each rule should check one thing:</p> <pre><code># Good - single responsibility\n@rule\ndef is_author(user, post):\n    return post.author == user\n\n@rule\ndef is_staff(user):\n    return user.is_staff\n\n# Use together\n@guard.any('is_author', 'is_staff', model=Post)\n</code></pre> <pre><code># Avoid - too many responsibilities\n@rule\ndef can_edit(user, post):\n    if user.is_superuser:\n        return True\n    if user.is_staff:\n        return True\n    if post.author == user:\n        return True\n    if user in post.editors.all():\n        return True\n    return False\n</code></pre>"},{"location":"guide/rules/#2-name-rules-clearly","title":"2. Name Rules Clearly","text":"<p>Use descriptive names that explain the permission:</p> <pre><code># Good\n@rule\ndef is_project_owner(user, project):\n    ...\n\n@rule\ndef can_view_draft(user, post):\n    ...\n\n# Avoid\n@rule\ndef check(user, obj):\n    ...\n\n@rule\ndef perm1(user):\n    ...\n</code></pre>"},{"location":"guide/rules/#3-handle-none-objects","title":"3. Handle None Objects","text":"<p>When a rule might receive <code>None</code>:</p> <pre><code>@rule\ndef can_edit_post(user, post):\n    if post is None:\n        return False\n    return post.author == user\n</code></pre>"},{"location":"guide/rules/#4-organize-rules-by-domain","title":"4. Organize Rules by Domain","text":"<p>Group related rules in dedicated files:</p> <pre><code>myapp/\n    permissions/\n        __init__.py\n        posts.py      # Post-related rules\n        users.py      # User-related rules\n        teams.py      # Team-related rules\n</code></pre> <p>Import all rules in <code>__init__.py</code>:</p> <pre><code># permissions/__init__.py\nfrom .posts import *\nfrom .users import *\nfrom .teams import *\n</code></pre>"},{"location":"guide/rules/#5-import-rules-early","title":"5. Import Rules Early","text":"<p>Rules must be imported before views use them. Import in your app's <code>apps.py</code>:</p> <pre><code># apps.py\nfrom django.apps import AppConfig\n\nclass MyAppConfig(AppConfig):\n    name = 'myapp'\n\n    def ready(self):\n        import myapp.permissions  # Register all rules\n</code></pre>"}]}